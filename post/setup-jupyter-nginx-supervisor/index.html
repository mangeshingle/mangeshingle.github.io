
<!DOCTYPE html>
<html lang="en-us">

<!-- Mirrored from www.albertauyeung.com/post/setup-jupyter-nginx-supervisor/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Nov 2018 14:48:01 GMT -->
<head>

  
  <meta charset="UTF-8">
  <title>
    Deploying Jupyter in Ubuntu with Nginx and Supervisor | Albert Au Yeung
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="index.html"/>

  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans">
  <link rel="stylesheet" href="../../css/sanitize.css">
  <link rel="stylesheet" href="../../css/responsive.css">
  <link rel="stylesheet" href="../../css/highlight.css">
  <link rel="stylesheet" href="../../css/theme.css">
  <link rel="stylesheet" href="../../css/custom.css">
  
  
  <link href="../../index.xml" rel="alternate" type="application/rss+xml" title="Albert Au Yeung" />
  <link href="../../index.xml" rel="feed" type="application/rss+xml" title="Albert Au Yeung" />

  
  


</head>



<body>
<div class="container">

  
  <header role="banner">
    <div class="row gutters">
      <div id="site-title" class="col span_6">
        <h1><a href="../../index.html">Albert Au Yeung</a></h1>
        <h2>Notes on machine learning and A.I.</h2>
      </div>
      <div id="social" class="col span_6">
        <ul>
          <li><a href="../../about/index.html">About</a></li>
          <li><a href="../index.html">Archive</a></li>
          <li><a href="https://github.com/albertauyeung" target="_blank">Github</a></li>
          <li><a href="https://www.linkedin.com/in/albert-au-yeung/" target="_blank">LinkedIn</a></li>
        </ul>
      </div>
    </div>
  </header>


  
  <main id="single" role="main">
    <div class="article-header">
      <h1>Deploying Jupyter in Ubuntu with Nginx and Supervisor</h1>
      <div class="meta">
        
        Mar 21, 2017 &nbsp;
        
        
      </div>
    </div>
    <article>
      

<p>The IPython Notebook, now called <a href="https://jupyter.org/">Jupyter Notebook</a>, is a convenient and interactive Web application for fast prototyping and testing ideas in Python (and R, Julia , Scala, and others) in the Web browser.</p>

<p><img src="../../images/jupyter.png" width="90%"/></p>

<p>Installing it on Ubuntu is easy, but it takes a little bit more effort to deploy it on a server and have it run as a service. This article serves as a simple guide to deploy Jupyter in a Ubuntu server, using the <a href="https://nginx.org/en/">Nginx</a> Web server and the <a href="http://supervisord.org/">supervisor</a> system.</p>

<h2 id="installing-jupyter">Installing Jupyter</h2>

<p>Detailed installation instructions for Jupyter can be found <a href="https://jupyter.readthedocs.io/en/latest/install.html">here</a>. Firstly, Python 2.7 or 3.3 or above should be installed. If you are using Ubuntu 14.04, it already comes with Python 3.4, and if you are using Ubuntu 16.04, it comes with Python 3.5. Here we assume that you normally use Python 3 as the default kernel. You can then install Jupyter using the following command, which would also install the dependencies. To have the latest version installed, you can first check and upgrade your pip to the latest version:</p>

<pre><code>$ sudo pip3 install --upgrade pip
$ sudo pip3 install jupyter
</code></pre>

<h2 id="installing-additional-kernels">Installing Additional Kernels</h2>

<p>Installing Jupyter using the above commands will have the Python 3 kernel installed as well. If you would like to run Python 2 in the notebooks, you can install the Python 2 kernal as well (see <a href="https://ipython.readthedocs.io/en/latest/install/kernel_install.html">here</a> for detailed instructions):</p>

<pre><code>$ sudo pip2 install ipykernel
$ sudo python2 -m ipykernel install --user
</code></pre>

<p>In fact, Juputer supports <a href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels">a large number of kernels</a>, such as R, Scala and Octave. For example, the Octave kernel can be installed through pip:</p>

<pre><code>$ sudo pip3 install octave_kernel
$ sudo python3 -m octave_kernel.install
</code></pre>

<h2 id="jupyter-configurations">Jupyter Configurations</h2>

<p>Once installed, you can run the Jupyter notebook server using the following command:</p>

<pre><code>$ jupyter notebook
</code></pre>

<p>The above command allows you to run the notebook server in your local computer, and by default will run on port 8888. You will be able to see the Jupyter notebook by accessing <a href="http://localhost:8888/">http://localhost:8888/</a>.</p>

<p>However, if you would like to install Jupyter notebook on your server (e.g. an instance on AWS or Google Cloud), it is better to deploy it properly so that you can access it through the commonly used HTTP ports (i.e. 80 for http or 443 for https), and have it automatically restarted in case it has stopped for some reasons. Hence, we will discuss how to deploy it on a server before. However, firstly, let&rsquo;s take a look at how we can configure Jupyter.</p>

<p>The Jupyter notebook can be configured with many different options. We can create a configuration file with all the default configurations commented out using the following command:</p>

<pre><code>$ jupyter notebook --generate-config
</code></pre>

<p>By default, the configuration file <code>jupyter_notebook_config.py</code> will be generated under the <code>.jupyter</code> folder under your home directory. The configuration file is well commented and should be self explanatory. Below are some commonly used options that you should set before going forward.</p>

<pre><code>c.NotebookApp.notebook_dir = '/path/to/notebook_directory'
c.NotebookApp.base_url = 'http://www.yourdomain.com/notebok'
c.NotebookApp.password = '...'
c.NotebookApp.port = 8888
c.NotebookApp.port_retries = 50
</code></pre>

<p>Note that the <code>base_url</code> parameter should match with the path set in Nginx later, so as the port number.</p>

<p>Also, you can follow the instructions in <a href="http://jupyter-notebook.readthedocs.io/en/latest/public_server.html">Jupyter&rsquo;s documentation</a> (reproduced below) to obtain the password string for the option above.</p>

<pre><code>In [1]: from notebook.auth import passwd
In [2]: passwd()
Enter password:
Verify password:
Out[2]: 'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'
</code></pre>

<p>As for the port option (<code>c.NotebookApp.port</code>), you can set it to whichever port you prefer, as we will set up Nginx as a reverse proxy to redirect requests to yor notebook server. In the discussion below, we assume that you have set the port number to 8888 as above.</p>

<h2 id="nginx-reverse-proxy">Nginx Reverse Proxy</h2>

<p><a href="https://nginx.org/en/">Nginx</a> is an event-driven based HTTP and reverse proxy server. It has recently gained much popularity because of its functionality and performance. In this guide, we will install Nginx as a Web server listening for HTTP requests on port 80, and will <strong>redirect</strong> requests to port 8888 if they are for the Jupyter Server.</p>

<p>Firstly, install Nginx using the command below:</p>

<pre><code>$ sudo apt-get update
$ sudo apt-get install nginx
</code></pre>

<p>Once installed, we can configure the Web server by editing the configuration file at <code>/etc/nginx/site-enabled/default</code>. Add the following block inside the <code>server</code> block.</p>

<pre><code>```
location /notebook {
    proxy_pass http://localhost:8888;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $http_host;
    proxy_http_version 1.1;
    proxy_redirect off;
    proxy_buffering off;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_read_timeout 86400;
}
```
</code></pre>

<p>In the above configuration, we ask Nginx to redirect all requests to the path <code>/notebook</code> to the port <code>8888</code> on <code>localhost</code>. This is where we will execute the Jupyter notebook. Also, the <code>Upgrade</code> header parameters are there so that the Websocket functions will work properly in Jupyter.</p>

<p>Once updated the configuration file, you can restart Nginx by using the following command:</p>

<pre><code>$ sudo service nginx restart
</code></pre>

<h2 id="supervisor-for-monitoring-the-service">Supervisor for Monitoring the Service</h2>

<p>Finally, we will execute Jupyter notebook on port <code>8888</code> with the configurations. You can of course simply use the command <code>jupyter notebook</code> to execute Jupyter, but we would like to run it more like a service or daemon in the background, and ask it to restart whenever something wrong happens and it is killed by the OS.</p>

<p>For this purpose, we will use <a href="http://supervisord.org/">supervisor</a>, which is a process control system for monitoring and controlling processes in UNIX-like OS. To install supervisor, you can run:</p>

<pre><code>$ sudo apt-get install supervisor
</code></pre>

<p>After that, you can check if the supervisor daemon is running, you can do the following:</p>

<pre><code>$ sudo supervisorctl
supervisor&gt;
</code></pre>

<p>If you see the prompt, that means it is installed and running successfully. Otherwise, you can start the service by yourself:</p>

<pre><code>$ sudo service supervisor start
</code></pre>

<p>To ask supervisor to monitor and control our Jupyter notebook, we need to first create a configuration file and place it in the <code>/etc/supervisor/conf.d</code>. Below is an example of the configuration file (which must be named with <code>.conf</code> extension):</p>

<pre><code>[program:jupyter]
command = jupyter notebook --no-browser --config=/path/to/config_file
directory = /path/to/jupyter/notebook/folder
user = ubuntu
autostart = true
autorestart = true
stdout_logfile = /path/to/log_file
redirect_stderr = true
</code></pre>

<p>After saving the configuration file to the directory <code>/etc/supervisor/conf.d</code>, you can ask supervisor to read the configuration file and start the program:</p>

<pre><code>$ sudo supervisorctl reread
$ sudo supervisorctl update
</code></pre>

<p>If the service is successfully configured and started, you can see something like the following when you execute the <code>supervisorctl</code> command without any parameters:</p>

<pre><code>$ sudo supervisorctl
jupyter     RUNNING    pid 1234, uptime 0:00:05
supervisor&gt;
</code></pre>

<p>You should now be able to access your Jupyter notebook at the URL `<a href="http://www.yourdomain.com/notebook">http://www.yourdomain.com/notebook</a>.</p>

      
      
      
    </article>
    
    
 <aside><div id="disqus_thread"></div></aside>

<script type="text/javascript">
     
    var disqus_shortname = 'albertauyeung';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



    
  </main>
  
  <nav class="pagination-single">
    <center>
      <a href="#">Back to Top</a>
    </center>
    
  </nav>


  
  <footer role="contentinfo">
    <div style="text-align:center; font-size: 0.8em">
      Copyright © 2017 Albert Au Yeung. All Rights Reserved.
    </div>
  </footer>


</div>

<script src="../../js/jquery-3.2.1.min.js"></script>
<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script src="../../../cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJaxdda6.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script>
$(document).ready(function() {
  var links = document.querySelectorAll('article a');
    for (var i = 0, length = links.length; i < length; i++) {
      if (links[i].hostname != window.location.hostname) {
        links[i].target = '_blank';
      }
  }
});
</script>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-30554548-1', 'auto');
	ga('send', 'pageview');
</script>

</body>

<!-- Mirrored from www.albertauyeung.com/post/setup-jupyter-nginx-supervisor/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Nov 2018 14:48:01 GMT -->
</html>

